"use strict";function findBiggestBlob(a){var b,c=unique(a),d=0,e=99999;for(b in c)0!=b&&c[b]>d&&(d=c[b],e=b);return{max:d,label:Number(e)}}function printa(a,b){for(var c=0,d=0;b>d;d++)console.log(a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],"  ",d)}function printa32(a,b){for(var c=0,d=0;b>d;d++)console.log(a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],a[c++],"  ",d)}function makeBlob(a,b,c,d){for(var e=1;d-1>e;e++)for(var f=1;c-1>f;f++){var g=e*c+f;a[g]=a[g]<=0?b:0}}function makeBlobInv(a,b,c,d){for(var e=1;d-1>e;e++)for(var f=1;c-1>f;f++){var g=e*c+f;a[g]=a[g]<=0?0:b}}function addOne(a,b,c,d,e){var f=d.pop(),g=e.pop();if(f){for(var h=1;c-1>h;h++)for(var i=1;b-1>i;i++){var j=h*b+i;0!==a[j]&&(a[j]=a[j]+TSTEP)}for(var i=0;i<f.length;i++)a[f[i]]=g[i]+TSTEP}}function subtactOne(a,b,c,d,e){for(var f=[],g=[],h=1;c-1>h;h++)for(var i=1;b-1>i;i++){var j=h*b+i;0!==a[j]&&(a[j]=a[j]-TSTEP,a[j]<=0&&(f.push(j),g.push(a[j])))}d.push(f),e.push(g)}function getDistances(a,b,c,d){for(var e=unique(b)[0]-(2*c+2*d-4),f=0,g=0;;){for(var h=1;d-1>h;h++)for(var i=1;c-1>i;i++){var j=h*c+i;if(0===b[j]){var k=[(h-1)*c+i,(h+1)*c+i,h*c+(i-1),h*c+(i+1)];if(-1===b[k[0]]||-1===b[k[1]]||-1===b[k[2]]||-1===b[k[3]]){f++;for(var l=[],m=0;m<k.length;m++)if(-1===b[k[m]]){l.push(a[k[m]]);var n=new Vector(1,a[k[m]]-a[j]);b[j]=n.length()}if(l.length>1){var o=_.min(l),n=new Vector(1,a[j]-o);b[j]=n.length()}}else if(0!==b[k[0]]||0!==b[k[1]]||0!==b[k[2]]||0!==b[k[3]]){f++;for(var l=[],p=[],m=0;m<k.length;m++)-1!==b[k[m]]&&0!==b[k[m]]&&(l.push(a[k[m]]),p.push(b[k[m]]));var q=_.min(p),n=new Vector(1,a[j]-l[_.indexOf(p,q)]);b[j]=n.length()+q}}}if(g++,f>=e)break}console.log("itterImage",g)}function getDistanceswQue(a,b,c,d,e,f){function g(f,g,i){if(!(g>=d-1||1>g||i>=c-1||1>i)&&1!==e[f]){for(var j=[(g-1)*c+i,(g+1)*c+i,g*c+(i-1),g*c+(i+1)],k=[],l=[],m=0;m<j.length;m++)-1!==b[j[m]]&&0!==b[j[m]]&&(k.push(a[j[m]]),l.push(b[j[m]]));var n=_.min(l),o=new Vector(1,a[f]-k[_.indexOf(l,n)]);b[f]=o.length()+n,0===b[j[0]]&&h.push(j[0],0),0===b[j[1]]&&h.push(j[1],0),0===b[j[2]]&&h.push(j[2],0),0===b[j[3]]&&h.push(j[3],0)}}for(var h=new UntidyPriorityQueue(20,2),i=(unique(b)[0]-(2*c+2*d-4),0),j=1;d-1>j;j++)for(var k=1;c-1>k;k++){var l=j*c+k;if(0==f[4*l+3])b[l]=999,e[l]=1;else if(0===b[l]){var m=[(j-1)*c+k,(j+1)*c+k,j*c+(k-1),j*c+(k+1)];if(-1===b[m[0]]||-1===b[m[1]]||-1===b[m[2]]||-1===b[m[3]]){i++;for(var n=[],o=0;o<m.length;o++)if(-1===b[m[o]]){n.push(a[m[o]]);var p=new Vector(1,a[m[o]]-a[l]);b[l]=p.length()}if(n.length>1){var q=_.min(n),p=new Vector(1,a[l]-q);b[l]=p.length()}e[l]=1,0===b[m[0]]&&h.push(m[0],0),0===b[m[1]]&&h.push(m[1],0),0===b[m[2]]&&h.push(m[2],0),0===b[m[3]]&&h.push(m[3],0)}}}for(;!h.empty();){var r=h.pop(),s=Math.floor(r/c),t=r%c;g(r,s,t),e[r]=1}}function getDistancesInvwQue(a,b,c,d,e,f){function g(f,g,i){if(!(g>=d-1||1>g||i>=c-1||1>i)&&1!==e[f]){for(var j=[(g-1)*c+i,(g+1)*c+i,g*c+(i-1),g*c+(i+1)],k=[],l=[],m=0;m<j.length;m++)-1!==b[j[m]]&&0!==b[j[m]]&&(k.push(a[j[m]]),l.push(b[j[m]]));var n=_.min(l),o=new Vector(1,a[f]-k[_.indexOf(l,n)]);b[f]=o.length()+n,0===b[j[0]]&&h.push(j[0],0),0===b[j[1]]&&h.push(j[1],0),0===b[j[2]]&&h.push(j[2],0),0===b[j[3]]&&h.push(j[3],0)}}for(var h=new UntidyPriorityQueue(20,2),i=0,j=1;d-1>j;j++)for(var k=1;c-1>k;k++){var l=j*c+k;if(0==f[4*l+3])b[l]=999,e[l]=1;else if(0===b[l]){var m=[(j-1)*c+k,(j+1)*c+k,j*c+(k-1),j*c+(k+1)];if(-1===b[m[0]]||-1===b[m[1]]||-1===b[m[2]]||-1===b[m[3]]){i++;for(var n=[],o=0;o<m.length;o++)if(-1===b[m[o]]){n.push(a[m[o]]);var p=new Vector(1,a[m[o]]-a[l]);b[l]=p.length()}if(n.length>1){var q=_.min(n),p=new Vector(1,a[l]-q);b[l]=p.length()}e[l]=1,0===b[m[0]]&&h.push(m[0],0),0===b[m[1]]&&h.push(m[1],0),0===b[m[2]]&&h.push(m[2],0),0===b[m[3]]&&h.push(m[3],0)}}}for(;!h.empty();){var r=h.pop(),s=Math.floor(r/c),t=r%c;g(r,s,t),e[r]=1}}function getGradients(a,b,c,d){for(var e=1;d-1>e;e++)for(var f=1;c-1>f;f++){var g=e*c+f,h=4*a[g]-a[(e-1)*c+f]-a[(e+1)*c+f]-a[e*c+(f-1)]-a[e*c+(f+1)];b[g]=h>=0?h:-h}}function unique(a){var b,c,d={},e=a.length;for(c=0;e>c;c+=1)b=a[c],d[b]?d[b]+=1:d[b]=1;return d}function selectview(a,b){mosaics=b,viewMosaic(mosaics),setupOverlaySelectView("#selectViewContainer",function(){})}function viewMosaic(a){b2=loadCanvas("selectViewContainer"),b2.width=a[0].width,b2.height=a[0].height,b2ctx=b2.getContext("2d"),b2ctx.globalAlpha=.7;for(var b=0;b<mosaics.length;b++)b2ctx.drawImage(mosaics[b],0,0)}function putMosaic(a){b2.width=mosaics[0].width,b2.height=mosaics[0].height,b2ctx.globalAlpha=.5;for(var b=0;b<mosaics.length;b++)b!=a&&b2ctx.drawImage(mosaics[b],0,0);b2ctx.globalAlpha=1,b2ctx.drawImage(mosaics[a],0,0)}function enablestart(){if(imagesReady){for(var a=0;a<imagesRef.length;a++)computedHs[a]={val:!1,bool:!1,H:allHomographies[a]};stitch=imagewarp(canvasDiv,allHomographies[0],imagesRef,selView)}}function placeimgs(a,b){for(var c=0;c<a.length;c++){var d=new Image;d.src=a[c],d.id=c.toString(),d.onclick=function(){var a=this.id;console.log(parseInt(a)),localStorage.setItem("selectImg",parseInt(a)),window.location.reload()},b.appendChild(d)}}function findScale(){return 1}function loadCanvas(a){var b=document.createElement("canvas"),c=document.getElementById(a);return b.id=a,c.appendChild(b),b}function selView(){if(999==localStorage.getItem("doMosaic")){localStorage.setItem("doMosaic",0),scrollToSelect();var a=stitch.getMosaic2();selectview("canvas",a)}else if(localStorage.getItem("selectImg")&&99!=localStorage.getItem("selectImg")){var b=localStorage.getItem("selectImg");console.log("load number",b),localStorage.setItem("selectImg",99),createImgObj(b)}else{console.log("Non set",localStorage.getItem("selectImg"));var a=stitch.getMosaic2();selectview("canvas",a)}}function createImgObj(a){$("#ComputingBlobs").show(),theImg=a,console.log("choose",a),document.getElementById(a.toString()).className+=" selected";var b=new Array(imagesRef.length),c=0;if(!computedHs[a].val){b[c++]=imagesRef[a],computedHs[a].val=!0;for(var d=0;d<imagesRef.length;d++)d!=a&&(b[c++]=imagesRef[d],computedHs[d].val=!1);stitch=imagewarp(canvasDiv,computedHs[a].H,b,blobStuff)}}function blobStuff(){blob?(blob.remove(),blob.createBlobView()):(blob=blobObj(),blob.createBlobView())}function scrollToSelect(){$("#btnScroll").hide();var a=document.getElementById("selectedF1");a.scrollIntoView(!0)}function doMosaic(){console.log("theImg",theImg),localStorage.setItem("doMosaic",999),window.location.reload()}function doReset(){console.log("Do reset with theImg",theImg),localStorage.setItem("selectImg",theImg),window.location.reload()}var testData=[0,1,1,1,1,1,1,1,1,1,0,1,2,2,2,2,2,2,1,1,0,1,2,3,3,3,3,3,1,1,0,1,2,3,4,4,4,3,1,1,0,1,2,3,4,5,5,3,1,1,0,1,2,3,4,5,5,3,1,1,0,1,2,3,4,4,4,3,1,1,0,1,2,3,3,3,3,3,1,1,0,1,2,2,2,2,2,2,1,1,0,1,1,1,1,1,1,1,1,1],TSTEP=1;!function(a){a.relativeBlobTreshold=function(a,b,c,d,e,f,g,h){{var i=a,j=c,k=d,l=0,m=new profiler;b.g}m.add("features");for(var n=findBlobs(b.g,c,d,e),o=n.data.slice(),p=n.data[f],q=[],r=0;r<n.data.length;r++)n.data[r]!=p?(n.data[r]=0,o[r]=-1):(n.data[r]=-1,o[r]=0,q.push(r));for(var s=[],t=zeros(s.length),u=zeros(s.length),r=0;r<n.data.length;r++)-1!=n.data[r]?(s[r]=0,u[r]=1):(s[r]=i,t[r]=1);1024==n.data.length&&printa32(o,32),m.start("features"),getDistanceswQue(b.g,n.data,c,d,t,h),getDistancesInvwQue(b.g,o,c,d,u,h),m.stop("features"),console.log("distances created in:",m.log(1),"ms");var v=numeric.round(n.data),w=numeric.round(o);1024==w.length&&printa32(w,32);var x=[],y=[],z=[],A=[];return{printId:function(){return console.log("The ID is:",i),this.id},changeId:function(a){i=a},updateThresholdIncreas:function(){return l++,l>0?(subtactOne(v,j,k,x,y),s=v.slice(),makeBlob(s,i,c,d),1024==v.length&&printa32(s,32)):(addOne(w,j,k,z,A),s=w.slice(),makeBlobInv(s,i,c,d),1024==v.length&&printa32(s,32)),s},updateThresholdDecreas:function(){return l--,l>=0?(addOne(v,j,k,x,y),s=v.slice(),makeBlob(s,i,c,d),1024==v.length&&printa32(s,32)):(subtactOne(w,j,k,z,A),s=w.slice(),makeBlobInv(s,i,c,d),1024==v.length&&printa32(s,32)),s},getBlob:function(){return s},id:i}}}(this);var mosaics=[],scrollValue=0,setupOverlaySelectView=function(){function a(a){var b=a.charAt(0);if("#"===b)var c=document.getElementById(a.slice(1,a.length));else var c=document.getElementById(a);var d={},e=function(a,b){var e,f=a.split(" "),g=f.length;for(e=0;g>e;e+=1)c.attachEvent?c.attachEvent("on"+f[e],b):c.addEventListener(f[e],b,!1);return d};return d.on=e,d.element=c,d}var b=null;return function(c,d){!function(a){return function(){a()}}(d);b=a(c);var e=document.getElementById("ComputingBlobs");b.on("touchstart mousedown",function(a){a.preventDefault?a.preventDefault():a.returnValue&&(a.returnValue=!1),console.log("down, scrollValue:",scrollValue),e.style.display="block"}).on("touchend mouseup",function(){e.scrollIntoView(!0),createImgObj(scrollValue)}).on("DOMMouseScroll mousewheel",function(a){a.preventDefault?a.preventDefault():a.returnValue&&(a.returnValue=!1);var b=a.wheelDelta?a.wheelDelta/40:a.detail?-a.detail:0;b>0&&scrollValue<mosaics.length-1?(scrollValue+=1,putMosaic(scrollValue)):0>b&&scrollValue>0&&(scrollValue-=1,putMosaic(scrollValue))})}}(),b2,b2ctx,imageSet=0,imagesRef=0,allHomographies=[];if(imageSet=localStorage.getItem("selectSceneNum")?localStorage.getItem("selectSceneNum"):1,11111==imageSet){console.log("Test set");var imagesRef=["../imgs/patch/P1_32_32.png","../imgs/patch/P2_32_32.png"],h1=[[1,0,0,0,1,0,0,0,1]];allHomographies=[h1,h1]}if(222222==imageSet){console.log("Test set");var imagesRef=["../imgs/patch/P1a_body_32_32.png","../imgs/patch/P3_body_32_32.png"],h1=[[1,0,0,0,1,0,0,0,1]];allHomographies=[h1,h1]}if(10==imageSet){var homographiesSkateH1=[[1.0123201608657837,-.03562629222869873,-.2494911551475525,.0240448247641325,1.003004550933838,-7.859261989593506,19387967768125236e-21,-2.606635973734228e-7,.9999918937683105],[1.0230095386505127,-.051322754472494125,-7.183257102966309,.03715682402253151,1.0254374742507935,-15.981046676635742,23618376872036606e-21,4184681529295631e-20,.9991756677627563],[1.0353878736495972,-.07033353298902512,-6.421023368835449,.05351170897483826,1.0444682836532593,-24.36629867553711,2706960731302388e-20,887837668415159e-19,.9977540373802185]],homographiesSkateH2=[[.9935616254806519,.022961584851145744,2.0279738903045654,-.016881121322512627,.9829508066177368,9.066900253295898,20164300167380134e-22,-27423269784776494e-21,.9997498393058777],[1.008139967918396,-.02915077470242977,-3.982980728149414,.013716734945774078,1.003922939300537,-4.8862786293029785,97715901574702e-19,9598177712177858e-21,.9999138712882996],[1.025726318359375,-.040721114724874496,-5.513948440551758,.0319267176091671,1.0321699380874634,-14.991840362548828,1794604759197682e-20,6677394412690774e-20,.9989356994628906]],homographiesSkateH3=[[.9844263195991516,.07760336250066757,.9172807931900024,-.038402311503887177,1.0057977437973022,10.538883209228516,-3209868009435013e-20,15300389350159094e-21,1.0001569986343384],[.9837057590484619,.02084650658071041,5.679980754852295,-.013236194849014282,.9741256833076477,8.169403076171875,-852894845593255e-20,-4212540443404578e-20,.9995958209037781],[1.0119044780731201,-.02471163496375084,1.0030813217163086,.019214699044823647,1.0028046369552612,-6.1342573165893555,1572541441419162e-20,7192982138803927e-21,.9999691247940063]],homographiesSkateH4=[[1.0034410953521729,.10580038279294968,-2.633333683013916,-.04826546460390091,1.0392612218856812,9.614594459533691,-1411048651789315e-20,48721445637056604e-21,1.0004931688308716],[.9702436327934265,.038123153150081635,5.645430088043213,-.030359214171767235,.9601770639419556,15.047872543334961,-18308333892491646e-21,-7151411409722641e-20,.9987723231315613],[.9932973384857178,.021523039788007736,-.7826990485191345,-.016987880691885948,.9987582564353943,5.709329128265381,-8478637028019875e-21,-54096171879791655e-22,.9999768733978271]];imagesRef=["../imgs/skate/3867131192_474809a118_z.jpg","../imgs/skate/3866347673_c48e0b9bb4_z.jpg","../imgs/skate/3866348017_518a69bc0d_z.jpg","../imgs/skate/3867132330_a95335e9bc_z.jpg"],allHomographies=[homographiesSkateH1,homographiesSkateH1,homographiesSkateH1,homographiesSkateH4]}if(1==imageSet){var homographiesSledgeH1=[[.8540396690368652,.050457216799259186,82.4438705444336,-.048826929181814194,.9423742294311523,-15.728147506713867,-.00022851054382044822,8584446186432615e-20,.9767833352088928]],homographiesSledgeH2=[[1.1210564374923706,-.04179324954748154,-95.68238830566406,.0580456405878067,1.056733250617981,11.733060836791992,.00022505367815028876,9044092439580709e-20,.9823490977287292]];imagesRef=["../imgs/sledge/4327623098_3cbf312e44_z.jpg","../imgs/sledge/4327623464_ccc39d973e_z.jpg"],allHomographies=[homographiesSledgeH1,homographiesSledgeH2]}if(9==imageSet){var homographiesBike2H1=[[1.0426149368286133,.005307071376591921,-189.84532165527344,.008166481740772724,1.0165867805480957,8.435789108276367,8387637353735045e-20,-3546401330822846e-21,.9846885204315186]],homographiesBike2H2=[[.9327494502067566,.006602529436349869,177.8943328857422,-.008301511406898499,.9705546498298645,-9.088162422180176,-797122047515586e-19,16857224181876518e-21,.9846625328063965]];allHomographies=[homographiesBike2H1,homographiesBike2H2],imagesRef=["../imgs/bike2/14581982516_3924617b5b_z.jpg","../imgs/bike2/14603000124_37300b9db1_z.jpg"]}if(3==imageSet){var homographiesELH1=[[1.0389015674591064,-.021919989958405495,-4.273282051086426,.09422748535871506,.9875717163085938,-5.8898749351501465,6793891952838749e-20,-867368362378329e-19,1.0001949071884155]],homographiesELH2=[[.9784799218177795,.014791175723075867,.5339639782905579,-.09201742708683014,1.0146938562393188,6.114669322967529,-5027901352150366e-20,6726609717588872e-20,1.0003852844238281]];allHomographies=[homographiesELH1,homographiesELH2],imagesRef=["../imgs/EandL/P1180178.jpg","../imgs/EandL/P1180179.jpg"]}else if(2==imageSet){var homographiesSkiH1=[[1.01169753074646,-.016839805990457535,22.81320571899414,.02119976095855236,.9952255487442017,-7.414227485656738,12518536095740274e-21,8109120244625956e-21,1.0002163648605347],[.9661481976509094,-.029190676286816597,113.27467346191406,.017496902495622635,.9802349805831909,-6.218682765960693,-40292612538905814e-21,-1541243545943871e-20,.9954161643981934],[.967432975769043,-.016158273443579674,150.0976104736328,.016845792531967163,.9825758337974548,-24.608877182006836,-4376105425762944e-20,280006952380063e-19,.9924551844596863],[.937919557094574,-.007838856428861618,150.89927673339844,-.0026983320713043213,.9693214297294617,-29.952003479003906,-7996862404979765e-20,9929681255016476e-21,.9868520498275757]],homographiesSkiH2=[[.9813196063041687,-.003270781831815839,-19.718448638916016,-.025491315871477127,.9755317568778992,11.485857009887695,-13089696949464269e-21,-6815016240580007e-20,.9994958639144897],[.9375579953193665,-.01717488095164299,92.28602600097656,-.006694590672850609,.9646527171134949,3.4758987426757812,-736266520107165e-19,-30116832931526005e-21,.9926178455352783],[.9423925876617432,-.011368698440492153,128.0341796875,.0032766549848020077,.9703877568244934,-17.63808822631836,-7681920396862552e-20,-841243763716193e-20,.989737331867218],[.9498104453086853,.020767856389284134,126.0226821899414,-.01134435087442398,.9838808178901672,-24.66139793395996,-7451975397998467e-20,41468072595307603e-21,.9890984892845154]],homographiesSkiH3=[[1.0139126777648926,.022940490394830704,-113.59968566894531,-.01728522591292858,1.0102853775024414,8.091630935668945,2689881148398854e-20,-5228447662375402e-21,.9969506859779358],[1.0451877117156982,.017562206834554672,-97.22286987304688,.007259022444486618,1.0259953737258911,-4.289793968200684,657521522953175e-19,1741613232297823e-20,.9938262701034546],[.9840916991233826,.0011156642576679587,40.44911193847656,-.0002805233816616237,.9953309297561646,-18.887020111083984,-2594508623587899e-20,11096006346633658e-21,.9987226128578186],[.9838175773620605,.01544911228120327,39.93574523925781,-.01599566452205181,.9923341870307922,-23.280550003051758,-2696404953894671e-20,2234232169939787e-21,.9988448619842529]],homographiesSkiH4=[[1.0269458293914795,.026224985718727112,-155.84146118164062,-.015786726027727127,1.0152915716171265,27.3282470703125,5677257286151871e-20,-354270468960749e-20,.9912620782852173],[1.034406304359436,.01214594952762127,-133.55679321289062,-.00219235778786242,1.0169494152069092,18.38968276977539,7074053428368643e-20,10010813866756507e-22,.990869402885437],[1.010952353477478,.0015984297497197986,-40.74266052246094,.00032625222229398787,1.003129482269287,19.029930114746094,21905025278101675e-21,-75593557085085195e-22,.99897301197052],[1.0019458532333374,.022620707750320435,-1.1114107370376587,-.015627743676304817,1.0039751529693604,-4.454003810882568,-8.904158903533244e-7,14966783965064678e-21,.9999342560768127]],homographiesSkiH5=[[1.02799391746521,.006391704082489014,-155.6632537841797,.0007734594983048737,1.0107998847961426,31.66087532043457,6575458246516064e-20,-2313648656127043e-20,.989302933216095],[1.0355504751205444,-.004942593164741993,-133.48455810546875,.012805087491869926,1.0172375440597534,23.023300170898438,786042510299012e-19,-3400243258511182e-21,.9897943735122681],[1.0128307342529297,-.017082683742046356,-40.7623405456543,.01680472120642662,1.0037094354629517,22.917695999145508,26313451598980464e-21,-9436296750209294e-21,.9987296462059021],[1.0027586221694946,-.02336910180747509,.014896824024617672,.017289433628320694,.9969953894615173,3.8658764362335205,8945458830567077e-21,-2403052531008143e-20,.9999077916145325]];allHomographies=[homographiesSkiH1,homographiesSkiH2,homographiesSkiH3,homographiesSkiH4,homographiesSkiH5],imagesRef=["../imgs/ski/ski1.jpg","../imgs/ski/ski2.jpg","../imgs/ski/ski3.jpg","../imgs/ski/ski4.jpg","../imgs/ski/ski5.jpg"]}else if(8==imageSet){var homographiesHundH1=[[.9959573149681091,-.004883802495896816,2.678840160369873,.005868001375347376,.9916155338287354,1.220236897468567,2886128186219139e-21,-19482627976685762e-21,.9999841451644897]],homographiesHundH2=[[1.0037338733673096,.0017153428634628654,-2.2722158432006836,-.004822799004614353,1.0045233964920044,-1.1375906467437744,-12442297929737833e-22,12024049283354543e-21,.9999890923500061]];allHomographies=[homographiesHundH1,homographiesHundH2],imagesRef=["../imgs/hundar/DSC6201.jpg","../imgs/hundar/DSC6202.jpg"]}else if(4==imageSet){var homographiesCarH1=[[1.0406215190887451,-.0030779337976127863,-140.2157440185547,.017164135351777077,1.0202465057373047,-.7551611661911011,9318920638179407e-20,-5.902680300096108e-7,.9874429702758789],[1.0750093460083008,-.02087479643523693,-508.8431701660156,.08801420778036118,1.0420607328414917,-16.94595718383789,.00040142808575183153,4092470044270158e-20,.8111422657966614]],homographiesCarH2=[[.972752034664154,-.0057953596115112305,134.65829467773438,-.008775225840508938,1.0011701583862305,-5.0560622215271,-4124096449231729e-20,2398512515355833e-20,.9941999316215515],[1.0654523372650146,-.025096984580159187,-361.77484130859375,.06723976880311966,1.0343387126922607,-5.541501045227051,.00023750626132823527,-31810126529308036e-21,.9189171195030212]],homographiesCarH3=[[.5839483737945557,-.034430377185344696,378.4354553222656,-.059002310037612915,.7470527291297913,-17.07809066772461,-.000307348178466782,-905879569472745e-19,.7977254986763],[.7873080372810364,.02911977842450142,311.2395935058594,-.05235334858298302,.8844791054725647,-15.283720016479492,-.0002088312030537054,21151159671717323e-21,.9176208972930908]];allHomographies=[homographiesCarH1,homographiesCarH2,homographiesCarH3],imagesRef=["../imgs/cars/DSC1526.jpg","../imgs/cars/DSC1533.jpg","../imgs/cars/DSC1561.jpg"]}else if(6==imageSet){var homographiesBike2H1=[[1.020303726196289,-.010079147294163704,-42.59284591674805,-.008457145653665066,.9905731081962585,-6.965245246887207,4839357643504627e-20,-.00012295154738239944,.9988846778869629],[.9562448859214783,-.04059208929538727,55.0452766418457,.002029840601608157,.9665254354476929,11.779176712036133,-5650325692840852e-20,-7099410140654072e-20,.9958619475364685]],homographiesBike2H2=[[.9660865664482117,-.008302299305796623,45.14383316040039,.005773747805505991,.9849867820739746,9.751049995422363,-490144120703917e-19,6797895184718072e-20,.9983599185943604],[.8957809209823608,-.025373294949531555,98.51021575927734,.004517511930316687,.939185619354248,21.728973388671875,-.00012811814667657018,-596984045841964e-20,.9856936931610107]],homographiesBike2H3=[[1.0311598777770996,.0011012349277734756,-54.12679672241211,-.0024361235555261374,1.0119781494140625,-11.21747875213623,6324340938590467e-20,-37644367694156244e-21,.9971030950546265],[1.0898643732070923,.06088623031973839,-113.0201416015625,-.008569265715777874,1.0580685138702393,-22.7808895111084,.00014498442760668695,5467134542413987e-20,.983923614025116]];imagesRef=["../imgs/bike/IMG_0050.JPG","../imgs/bike/IMG_0051.JPG","../imgs/bike/IMG_0053.JPG"],allHomographies=[homographiesBike2H1,homographiesBike2H2,homographiesBike2H3]}else if(7==imageSet){var homographiesSienceParkH1=[[1.3479026556015015,.008745760656893253,-210.18344116210938,.15344436466693878,1.1760369539260864,-84.88064575195312,.0006413722294382751,6606439274037257e-20,.896777331829071]],homographiesSienceParkH2=[[.5946701169013977,-.023367745801806453,140.58761596679688,-.10435666143894197,.7485773563385015,45.653278350830085,-.00041533523472025996,-7564908446511255e-20,.8931218385696411]];allHomographies=[homographiesSienceParkH1,homographiesSienceParkH2],imagesRef=["../imgs/sciencepark/P1100328.jpg","../imgs/sciencepark/P1100329.jpg"]}else if(5==imageSet){var homographiesBirdH1=[[1.0095304250717163,-.016554025933146477,8.953278541564941,.03932776674628258,1.01807701587677,-168.96636962890625,-7351650765485829e-21,.00010901226050918922,.9818366169929504]],homographiesBirdH2=[[.9741345047950745,.016616482287645343,-6.28730344772339,-.035838641226291656,.9484438896179199,163.43844604492188,12708939721051138e-21,-.00010157084761885926,.9824137687683105]];imagesRef=["../imgs/bird/P1.jpg","../imgs/bird/P2.jpg"],allHomographies=[homographiesBirdH1,homographiesBirdH2]}var stitch={},computedHs={},canvasDiv="CANVAS",imagesReady=!1,result_canvas_bottom,result_canvas_top,imageCanvases={};$(window).load(function(){imagesReady=!0,enablestart()});var selDiv1=document.querySelector("#selectedF1");placeimgs(imagesRef,selDiv1);var blob,theImg=99999,finalcanvas=loadCanvas("final-canvas"),mouse={},myblobs1=[];!function(a){a.blobObj=function(){function a(){i=0;var a=e[0],c=b(a);h=[];for(var d={},g=1;g<imagesRef.length;g++)d[g]=14;for(var g=1;g<imagesRef.length;g++){var j=e[g],k=b(j);myblobs1[g]=findDiff(c,k,j.width,j.height,g),j.blobs=myblobs1[g].getData(),console.log(" num unique",j.blobs.numberOfUnique,"length",j.blobs.data.length);for(var l=0;l<j.blobs.numberOfUnique;l++){for(var m=l+1,n=zeros(j.blobs.data.length),o=0;o<j.blobs.data.length;o++)m===j.blobs.data[o]&&(n[o]=m+i);h.push([n,g])}i+=j.blobs.numberOfUnique}for(var g=0;i>g;g++)f[g+1]=!1;return h}function b(a){for(var b=0,c=0,d=new jsfeat.matrix_t(a.width,a.height,jsfeat.F32_t|jsfeat.C1_t),e=new jsfeat.matrix_t(a.width,a.height,jsfeat.F32_t|jsfeat.C1_t),f=new jsfeat.matrix_t(a.width,a.height,jsfeat.F32_t|jsfeat.C1_t),g=new jsfeat.matrix_t(a.width,a.height,jsfeat.U8_t|jsfeat.C1_t),h=0;h<a.height;h++)for(var i=0;i<a.width;i++,b+=4,c+=1)d.data[c]=a.data[b],e.data[c]=a.data[b+1],f.data[c]=a.data[b+2],g.data[c]=a.data[b+3];return[d,e,f,g]}function c(){var a=document.createElement("input");a.type="button",a.className="btn btn-primary",a.value="reset",a.onclick=d;var b=document.getElementById("btn1");b.appendChild(a)}function d(){doReset()}var e={},f={},g={},h=[];$("#btn1").hide(),c();var i=0;return{createBlobView:function(){result_canvas_bottom=document.getElementById("blobsbottom"),result_canvas_top=document.getElementById("blobstop"),e=stitch.getOverlap();var b=stitch.getModOverlap();g=a(),$("#selectInterface").hide(),$("#ComputingBlobs").hide(),$("#blobInterface").show(),mouse=interactMouse(g,e,f,e[0].width,e[0].height,b),mouse.setup(0),redrawScrean(g,e,f);var c=document.getElementById("selectedF1");return c.scrollIntoView(!0),1},getData:function(){return 1},remove:function(){return d(),result_canvas_bottom={},result_canvas_top={},f={},e={},myblobs1=[],g={},h=[],imgData=[],modImgData=[],blobData=[],1}}}}(this);